var UI=UI||{version:"0.1b",author:"Code Floor",elements:new Array(),props:{}};UI.Canvas=new Class({Implements:[Events,Options],options:{props:{},width:300,height:150,className:"ui-canvas",disableShadowOnExplorer:true,debug:false,onComplete:$empty},initialize:function(A){this.setOptions(A);this.props=this.options.props;this.build();this.setSize();this.shadowsLoaded=false;this.shadowSet=false;this.draw()},build:function(){this.canvas=new Canvas({"class":this.options.className,styles:{position:"absolute",zIndex:-1}});this.ctx=this.canvas.getContext("2d")},setSize:function(C,A,B){if(B){this.props=B}this.shadowSize=this.props.layers.shadow.size;this.shadowMagnify=this.props.layers.shadow.magnify;this.shadowOffset=[this.props.layers.shadow.offsetX,this.props.layers.shadow.offsetY];this.shadowThikness=this.shadowSize+this.shadowMagnify;this.canvasSize=[(C||this.options.width)+this.shadowThikness*2+Math.abs(this.shadowOffset[0]),(A||this.options.height)+this.shadowThikness*2+Math.abs(this.shadowOffset[1])];this.canvas.setProperties({width:this.canvasSize[0],height:this.canvasSize[1]});this.canvas.setStyles({top:-this.shadowThikness,left:-this.shadowThikness,width:this.canvasSize[0],height:this.canvasSize[1]});this.absSize=[this.canvasSize[0]-this.shadowThikness*2-Math.abs(this.shadowOffset[0]),this.canvasSize[1]-this.shadowThikness*2-Math.abs(this.shadowOffset[1])];this.relSize=this.absSize;this.offset=[this.shadowThikness,this.shadowThikness];if(C,A){this.draw()}},draw:function(A){if(!this.shadowSet){if(A){this.props=A}this.ctx.clearRect(0,0,this.canvasSize[0],this.canvasSize[1]);if(this.shadowSize&&!this.drawShadowsCalled&&(Browser.Engine.trident&&!this.options.disableShadowOnExplorer||!Browser.Engine.trident)){this.drawShadows();return }}var B=new Hash(this.props.layers);if(this.props.layers.reorder){this.props.layers.reorder.each(function(C){if(C!="default"&&C!="reorder"&&C!="shadow"){this.trace(C)}},this)}else{B.each(function(D,C){if(C!="default"&&C!="reorder"&&C!="shadow"){this.trace(C)}},this)}this.offset=[this.shadowThikness,this.shadowThikness];this.relSize=[this.canvasSize[0]-this.shadowThikness*2-Math.abs(this.shadowOffset[0]),this.canvasSize[1]-this.shadowThikness*2-Math.abs(this.shadowOffset[1])];this.shadowSet=false;this.fireEvent("complete")},drawShadows:function(){var J=null;$H(this.props.layers).each(function(M,L){if(L!="shadow"&&L!="default"){J=J||L}});var A=this.getProperties(J);if(this.props.layers.shadow.color&&this.props.layers.shadow.color.test(/#[0-9A-F]+/)){var C=this.props.layers.shadow.color.hexToRgb(true)}else{var C="0,0,0"}var K=[this.canvasSize[0]-this.shadowOffset[0],this.canvasSize[1]-this.shadowOffset[1]];var B=1.3;if($defined(this.props.layers.shadow.radius)){A.radius=[this.props.layers.shadow.radius,this.props.layers.shadow.radius,this.props.layers.shadow.radius,this.props.layers.shadow.radius]}var F=[B*(this.props.layers.shadow.size-1-this.props.layers.shadow.magnify+A.radius[0]),B*(this.props.layers.shadow.size-1-this.props.layers.shadow.magnify+A.radius[1]),B*(this.props.layers.shadow.size-1-this.props.layers.shadow.magnify+A.radius[2]),B*(this.props.layers.shadow.size-1-this.props.layers.shadow.magnify+A.radius[3])];var E=(this.props.layers.shadow.opacity||1)/1;var G=A.shape;var I={radius:F,color:this.props.layers.shadow.color||"#000",size:K,offset:[this.shadowOffset[0],this.shadowOffset[1]]};for(var D=this.shadowThikness*1.5;D>0;D--){var H=E/(D*2/1.5+10);this.ctx.save();this.setTransformation(I);this[G](I);this.ctx.fillStyle="rgba("+C+", "+H+")";this.ctx.fill();this.ctx.restore();I.size=[I.size[0]-2,I.size[1]-2];I.offset=[++I.offset[0],++I.offset[1]];I.radius=[I.radius[0]>0?I.radius[0]-B:0,I.radius[1]>0?I.radius[1]-B:0,I.radius[2]>0?I.radius[2]-B:0,I.radius[3]>0?I.radius[3]-B:0,]}A.offset[0]++;A.offset[1]++;A.size[0]=A.size[0]-2;A.size[1]=A.size[1]-2;this.ctx.save();this.setTransformation(A);this.ctx.globalCompositeOperation="destination-out";this[G](A);this.ctx.fill();this.ctx.restore();this.shadowSet=true;this.draw()},inject:function(B,A){this.canvas.inject(B,A);return this},trace:function(B){var A=this.getProperties(B);if(this.options.debug){for(var D in A){if(A[D]=="NaN"){console.log(A[D]);return }if($type(A[D])=="array"||$type(A[D])=="object"){for(var C in A[D]){if(A[D][C]=="NaN"){console.log(C+" , Nan","("+this.options.skin+"=>"+this.options.component+"=>"+this.options.type+"=>"+this.options.state+")");return }}}}if(A.size&&!A.size[0]&&!A.size[1]){console.log(B+" , size is null","("+this.options.skin+"=>"+this.options.component+"=>"+this.options.type+"=>"+this.options.state+")");return }}this.ctx.save();this.setTransformation(A);switch(A.shape){case"circle":this.circle(A);break;case"roundedRect"||"roundRect":this.roundedRect(A);break;case"line"||"lineDown":A.direction="down";this.line(A);break;case"lineUp":A.direction="up";this.line(A);break;case"triangle":this.triangle(A);break}this.drawShape(A);this.ctx.restore()},convert2Px:function(B,C,D){C=(C=="x")?0:1;var A=D?this.absSize[C]:this.relSize[C];if($type(B)=="string"){if(B.match(/%$/)){return B.toInt()/100*A}else{if(B.match(/px$/)){return B.toInt()}else{if(B=="auto"){return B}}}}else{return B}},setOffset:function(F,C,D){var H=(C=="relative")?false:true;F=[this.convert2Px(F[0],"y",H),this.convert2Px(F[1],"x",H),this.convert2Px(F[2],"y",H),this.convert2Px(F[3],"x",H)];if(D){if($type(D)=="array"&&D[1]&&D[0]=="auto"&&D[1]!="auto"){D[1]=this.convert2Px(D[1],"y",H)}else{if($type(D)=="array"&&D[1]&&D[0]!="auto"&&D[1]=="auto"){D[0]=this.convert2Px(D[0],"x",H)}else{if($type(D)=="array"&&D[1]&&D[0]!="auto"&&D[1]!="auto"){D[0]=this.convert2Px(D[0],"x",H);D[1]=this.convert2Px(D[1],"y",H)}else{if($type(D)=="array"&&D[1]&&D[0]=="auto"&&D[1]=="auto"){D=false}else{if(D!="auto"){D=[this.convert2Px(D,"x",H),this.convert2Px(D,"y",H)]}}}}}}if(!D){if(H){var B=F[3]+this.shadowThikness;var G=F[0]+this.shadowThikness;var E=this.absSize[0]-F[1]-F[3];var A=this.absSize[1]-F[0]-F[2]}else{var B=this.offset[0]+F[3];var G=this.offset[1]+F[0];var E=this.relSize[0]-F[1]-F[3];var A=this.relSize[1]-F[0]-F[2];this.offset=[B,G];this.relSize=[E,A]}}else{switch(true){case F[3]!="auto":if(H){var E=(D[0]=="auto")?this.absSize[0]-F[1]-F[3]:D[0];var B=F[3]+this.shadowThikness}else{var E=(D[0]=="auto")?this.relSize[0]-F[1]-F[3]:D[0];var B=this.offset[0]+F[3];this.offset[0]=B;this.relSize[0]=E}break;case F[1]!="auto":if(H){var E=(D[0]=="auto")?this.absSize[0]-F[1]-F[3]:D[0];var B=this.absSize[0]-E-F[1]+this.shadowThikness}else{var E=(D[0]=="auto")?this.relSize[0]-F[1]-F[3]:D[0];var B=this.offset[0]+this.relSize[0]-E-F[1];this.offset[0]=B;this.relSize[0]=E}break;case F[3]=="auto"&&F[1]=="auto":if(H){var E=D[0];var B=(this.absSize[0]-E)/2+this.shadowThikness}else{var E=D[0];var B=(this.relSize[0]-E)/2;this.offset[0]=B;this.relSize[0]=E}break}switch(true){case F[0]!="auto":if(H){var A=(D[1]=="auto")?this.absSize[1]-F[0]-F[2]:D[1];var G=F[0]+this.shadowThikness}else{var A=(D[1]=="auto")?this.relSize[1]-F[0]-F[2]:D[1];var G=this.offset[1]+F[0];this.offset[1]=G;this.relSize[1]=A}break;case F[2]!="auto":if(H){var A=(D[1]=="auto")?this.absSize[1]-F[0]-F[2]:D[1];var G=this.absSize[1]-A-F[2]+this.shadowThikness}else{var A=(D[1]=="auto")?this.relSize[1]-F[0]-F[2]:D[1];var G=this.offset[1]+this.relSize[1]-A-F[2];this.offset[1]=G;this.relSize[1]=A}break;case F[0]=="auto"&&F[2]=="auto":if(H){var A=D[1];var G=(this.absSize[1]-A)/2+this.shadowThikness}else{var E=D[1];var G=(this.relSize[1]-A)/2;this.offset[1]=G;this.relSize[1]=A}break}}return[B,G,E,A]},getProperties:function(C){var B={position:$pick(this.props.layers[C].position,this.props.layers["default"].position),size:$pick(this.props.layers[C].size,this.props.layers["default"].size),shape:$pick(this.props.layers[C].shape,this.props.layers["default"].shape),color:$pick(this.props.layers[C].color,this.props.layers["default"].color),gradient:$pick(this.props.layers[C].gradient,this.props.layers["default"].gradient),stroke:$pick(this.props.layers[C].stroke,this.props.layers["default"].stroke),image:$pick(this.props.layers[C].image,this.props.layers["default"].image),width:$pick(this.props.layers[C].width,this.props.layers["default"].width),opacity:$pick(this.props.layers[C].opacity,this.props.layers["default"].opacity),angle:$pick(this.props.layers[C].angle,this.props.layers["default"].angle),rotation:$pick(this.props.layers[C].rotation,this.props.layers["default"].rotation),scale:$pick(this.props.layers[C].scale,this.props.layers["default"].scale),composite:$pick(this.props.layers[C].composite,this.props.layers["default"].composite)};var D=$pick(this.props.layers[C].offset,this.props.layers["default"].offset);if($type(D)=="array"){if($defined(D[3])){D=this.setOffset(D,B.position,B.size)}else{if($defined(D[2])){D=this.setOffset([D[0],D[1],D[2],D[1]],B.position,B.size)}else{D=this.setOffset([D[0],D[1],D[0],D[1]],B.position,B.size)}}}else{D=this.setOffset([D,D,D,D],B.position,B.size)}B.offset=[D[0],D[1]];B.size=[D[2],D[3]];var A=$pick(this.props.layers[C].radius,this.props.layers["default"].radius);if($type(A)=="array"){B.radius=$defined(A[3])?A:[A[0],A[0],A[1],A[1]]}else{B.radius=[A,A,A,A]}return B},setColor:function(D,J){var B=(D=="fill")?"gradient":"stroke";if(!J[B]){J[B]={color:J.color,opacity:J.opacity||1}}if(J[B]&&$type(J[B].color)=="array"){if(!$defined(J[B].angle)){J[B].angle=90}var M=J[B].angle*Math.PI/180;var K=Math.abs(M);this.ctx.ratio=J.size[1]/J.size[0];this.ctx.angle=M;if(J[B].angle>=-90&&J[B].angle<90){var A=-((Math.cos(M-Math.atan(J.size[1]/J.size[0]))*Math.sqrt(Math.pow(J.size[0],2)+Math.pow(J.size[1],2))*Math.cos(M))/2);var N=-((Math.cos(M-Math.atan(J.size[1]/J.size[0]))*Math.sqrt(Math.pow(J.size[0],2)+Math.pow(J.size[1],2))*Math.sin(M))/2)}else{var A=((Math.cos(Math.PI-M-Math.atan(J.size[1]/J.size[0]))*Math.sqrt((J.size[0]).pow(2)+(J.size[1]).pow(2))*Math.cos(Math.PI-M))/2);var N=-((Math.cos(Math.PI-M-Math.atan(J.size[1]/J.size[0]))*Math.sqrt((J.size[0]).pow(2)+(J.size[1]).pow(2))*Math.sin(Math.PI-M))/2)}var I=-A;var H=-N;var E=this.ctx.createLinearGradient(A,N,I,H);var C=J[B].color.length;if(!J[B].opacity||$type(J[B].opacity)!="array"){var G=J[B].opacity||1;J[B].opacity=[];for(var F=0;F<C;F++){J[B].opacity[F]=G}}if(!J[B].stop){J[B].stop=[];for(var F=0;F<C;F++){J[B].stop[F]=F*(1/(C-1))}}for(var F=0;F<C;F++){var L="rgba("+J[B].color[F].hexToRgb(true).join(",")+", "+J[B].opacity[F]+")";E.addColorStop(J[B].stop[F],L)}}else{J[B].opacity=J[B].opacity||1;var E="rgba("+J[B].color.hexToRgb(true).join(",")+","+J[B].opacity+")"}this.ctx[D+"Style"]=E},setTransformation:function(A){this.ctx.translate(A.size[0]/2+A.offset[0],A.size[1]/2+A.offset[1]);if(A.rotation){this.ctx.rotate(Math.PI*A.rotation/180)}if(A.scale){if($type(A.scale)!="array"){A.scale=[A.scale,A.scale]}this.ctx.scale(A.scale[0],A.scale[1])}if(A.composite){this.ctx.globalCompositeOperation=A.composite}},drawShape:function(A){if(A.image){this.setImage(A)}else{if(A.color||A.gradient){this.setColor("fill",A);this.ctx.fill()}}if(A.stroke){this.ctx.lineWidth=(A.stroke.width)?A.stroke.width:1;this.setColor("stroke",A);this.ctx.stroke()}},setImage:function(B){B.image.pattern=B.image.pattern||"repeat";var A=new Image();A.onload=function(){var C=this.ctx.createPattern(A,B.image.pattern);this.ctx.fillStyle=C;this.ctx.fill()}.bind(this);A.src=B.image.url},roundedRect:function(A){this.ctx.beginPath();this.ctx.moveTo(A.radius[0]-A.size[0]/2,-A.size[1]/2);this.ctx.lineTo(A.size[0]-A.radius[1]-A.size[0]/2,-A.size[1]/2);this.ctx.quadraticCurveTo(A.size[0]-A.size[0]/2,-A.size[1]/2,A.size[0]-A.size[0]/2,A.radius[1]-A.size[1]/2);this.ctx.lineTo(A.size[0]-A.size[0]/2,A.size[1]-A.radius[2]-A.size[1]/2);this.ctx.quadraticCurveTo(A.size[0]-A.size[0]/2,A.size[1]-A.size[1]/2,A.size[0]-A.radius[2]-A.size[0]/2,A.size[1]-A.size[1]/2);this.ctx.lineTo(A.radius[3]-A.size[0]/2,A.size[1]-A.size[1]/2);this.ctx.quadraticCurveTo(-A.size[0]/2,A.size[1]-A.size[1]/2,-A.size[0]/2,A.size[1]-A.radius[3]-A.size[1]/2);this.ctx.lineTo(-A.size[0]/2,A.radius[0]-A.size[1]/2);this.ctx.quadraticCurveTo(-A.size[0]/2,-A.size[1]/2,A.radius[0]-A.size[0]/2,-A.size[1]/2);this.ctx.closePath()},circle:function(D){D.angle=D.angle||[0,360];var B=0;var F=0;var E=D.size[1]/2;var A=Math.PI*D.angle[0]/180;var C=Math.PI*D.angle[1]/180;this.ctx.beginPath();this.ctx.arc(B,F,E,C,A,true);this.ctx.closePath()},line:function(A){A.stroke=A.stroke||{color:A.color,width:A.width};delete A.color;this.ctx.beginPath();if(A.direction=="up"){this.ctx.moveTo(-A.size[0]/2+0.5,A.size[1]/2-0.5);this.ctx.lineTo(A.size[0]/2-0.5,-A.size[1]/2+0.5)}else{this.ctx.moveTo(-A.size[0]/2+0.5,-A.size[1]/2+0.5);this.ctx.lineTo(A.size[0]/2-0.5,A.size[1]/2-0.5)}},triangle:function(A){this.ctx.beginPath();this.ctx.moveTo(-A.size[0]/2,A.size[1]/2);this.ctx.lineTo(A.size[0]/2,A.size[1]/2);this.ctx.lineTo(0,-A.size[1]/2);this.ctx.closePath()}});UI.Skin=new Class({Implements:[Events,Options],options:{skin:"AquaGraphite"},initialize:function(A){this.setOptions(A);this.defaultSkin=this.options.skin;return this},processSkin:function(B){for(var A in UI.props[B]){if(A!="default"){for(var C in UI.props[B][A]){for(var E in UI.props[B][A][C]){if(E!="shortcuts"){var D=UI.props[B]["default"];if(UI.props[B][A]["default"]){D=this.merge(D,UI.props[B][A]["default"]["default"],UI.props[B][A]["default"][E])}D=this.merge(D,UI.props[B][A][C]["default"],UI.props[B][A][C][E]);UI.props[B][A][C][E]=D}}}}}UI.props[B].preprocessed=true},get:function(className){var skin=className.options.skin?className.options.skin:this.defaultSkin,cKey=className.options.component,tKey=className.options.type,props=className.options.props,styles=className.options.styles;if(!UI.props[skin].preprocessed){this.processSkin(skin)}if(UI.props[skin][cKey][tKey]){var type=$unlink(UI.props[skin][cKey][tKey])}else{if(UI.props[skin][cKey]["default"]){var type=$unlink(UI.props[skin][cKey]["default"])}else{var type={"default":$unlink(UI.props[skin]["default"])}}}for(var csKey in props){if(!type[csKey]){type[csKey]=props[csKey]}}for(var sKey in type){if(type[sKey].shortcuts){for(var scKey in type[sKey].shortcuts){if(className.options[scKey]){eval("type['"+sKey+"']."+type[sKey].shortcuts[scKey]+" = this.merge(type['"+sKey+"']."+type[sKey].shortcuts[scKey]+",className.options."+scKey+")")}}}if(props){type[sKey]=this.merge(type[sKey],props["default"],props[sKey])}type[sKey].styles=this.merge(type[sKey].styles,styles)}if(type["default"].layers.shadow.size==0){delete type["default"].shadows}return type},getComponentProps:function(C,B){var A={};$H(C).each(function(E,D){if(E.components&&E.components[B]){A[D]=E.components[B]}});return A},merge:function(){var E={};for(var D=0,A=arguments.length;D<A;D++){var B=arguments[D];for(var C in B){var G=B[C],F=E[C];E[C]=($type(G)=="object"&&$type(F)=="object")?this.merge(F,G):G}}return E}});UI.Element=new Class({Implements:[Events,Options],options:{lib:"ui",component:"element",type:"default",state:"default",className:false,tag:"span",resizable:false,draggable:false,selectable:true,skin:"AquaGraphite",props:false,styles:{},debug:false,group:false,onClick:$empty,onMouseDown:$empty,onBuild:$empty,onBuildComplete:$empty,onResizeStart:$empty,onResize:$empty,onResizeComplete:$empty,onDragStart:$empty,onDrag:$empty,onDragComplete:$empty,onShow:$empty,onHide:$empty},initialize:function(A){this.setOptions(A);if(!this.controller){this.controller=ui.controller}this.setClassName();this.setSkin();this.build();this.setBehavior()},toElement:function(){return this.element},build:function(){this.fireEvent("build");this.element=new Element(this.options.tag,{"class":this.className,styles:this.props.styles,events:this.options.events,id:this.options.id,name:this.options.name,html:this.options.html,"for":this.options["for"]});if(!this.options.selectable){this.element.disableSelect()}this.element.ui=true;this.state=this.options.state;this.dragHandlers=[]},setClassName:function(){if(this.options.className){this.className=this.options.className}else{this.className=this.options.lib+"-"+this.options.component;if(this.options.type!="default"){this.className=this.className+"-"+this.options.type}if(this.options.state!="default"){this.className=this.className+"-"+this.options.state}}},setSkin:function(){UI.skin=new UI.Skin(this.options.skin);this.skin=UI.skin.get(this);this.props=this.skin[this.options.state]},setCanvas:function(){if(this.canvas||(this.props&&!this.props.layers)||(this.props&&this.props.layers&&$H(this.props.layers).getLength()<=2)){return false}this.canvas=new UI.Canvas({props:this.props,width:this.element.x,height:this.element.y,debug:this.options.debug,element:this.element,skin:this.options.skin,component:this.options.component,type:this.options.type,state:this.options.state,}).inject(this.element);this.addEvent("canvasDraw",function(B){if(!B){var A=this.props}else{var A=this.skin[B]||this.props}this.canvas.setSize(this.element.x,this.element.y,A)})},setState:function(B,A){if(this.skin[B]){this.state=B;if(this.skin[B].styles){this.setStyles(this.skin[B].styles)}if($defined(A)){this.setSize(A.width,A.height,B)}else{this.fireEvent("canvasDraw",B)}}return this},setSize:function(B,A,C){this.fireEvent("onResize");this.element.x=B||this.options.width||this.props.width||this.element.getSize().x;this.element.y=A||this.options.height||this.props.height||this.element.getSize().y;if(this.element.x){this.element.setStyle("width",this.element.x)}if(this.element.y){this.element.setStyle("height",this.element.y)}this.fireEvent("canvasDraw",C);return this},setLocation:function(C,B,A){this.element.left=C||this.options.left||this.props.defaultLeft||this.element.getCoordinates().x-this.props.shadowMagnify*2;this.element.top=B||this.options.top||this.props.defaultTop||this.element.getCoordinates().y-this.props.shadowMagnify*2;this.element[A?"morph":"setStyles"]({top:this.element.top,left:this.element.left});return this},setBehavior:function(){if(this.options.draggable){this.enableDrag()}if(this.options.resizable){this.enableResize()}this.element.addEvents({mousedown:this.fireEvent.bind(this,"mousedown"),click:function(){if(!Browser.Engine.trident){this.fireEvent("click")}}.bind(this),mouseup:function(){if(Browser.Engine.trident){this.fireEvent("click")}this.fireEvent("mouseup")}.bind(this),mouseenter:this.fireEvent.bind(this,"mouseenter"),mouseleave:this.fireEvent.bind(this,"mouseleave"),mouseover:this.fireEvent.bind(this,"mouseover"),mouseOut:this.fireEvent.bind(this,"mouseOut"),})},enableDrag:function(){if(this.dragHandlers.length==0){this.dragHandlers=null}this.dragHandler=new Drag(this.element,{handle:this.dragHandlers,limit:{x:this.options.dragLimitX,y:this.options.dragLimitY},onStart:this.fireEvent.bind(this,"onDragStart"),onDrag:this.fireEvent.bind(this,"onDrag"),onComplete:this.fireEvent.bind(this,"onDragComplete")});this.addEvents({onDragComplete:this.adaptLocation.bind(this)});return this},disableDrag:function(){if(this.dragHandler){this.dragHandler.stop()}return this},enableResize:function(){this.element.makeResizable({handle:this.resize,limit:{x:this.options.resizeLimitX,y:this.options.resizeLimitX},onStart:function(){this.fireEvent("onResizeStart")}.bind(this),onDrag:function(){this.fireEvent("onResizeDrag")}.bind(this),onComplete:function(){this.fireEvent("onResizeComplete")}.bind(this)});this.addEvents({onResizeDrag:function(){this.setSize(this.element.getSize().x,this.element.getSize().y)}});return this},getCenterLocation:function(){var A={};A.top=(window.getHeight()-this.options.height.toInt())/2,A.left=(window.getWidth()-this.options.width.toInt())/2;return A},adaptLocation:function(){var A={};var B=false;var C=this.element.getCoordinates();if(C.top.toInt()>window.getHeight()-53){A.top=window.getHeight()-$random(25,75);B=true}if(C.left.toInt()+this.element.getStyle("width").toInt()<0){A.left=$random(25,75)-this.element.getStyle("width").toInt();B=true}if(this.element.getStyle("left").toInt()>window.getWidth()){A.left=window.getWidth()-$random(25,75);B=true}if(B){if(this.props.fx&&this.props.fx.adaptLocation){if(!this.reposFx){this.reposFx=new Fx.Morph(this.element,this.props.fx.adaptLocation)}this.reposFx.start(A)}}},show:function(){this.fireEvent("show");this.element.setStyle("opacity",1);this.element.show();return this},hide:function(){this.fireEvent("hide");this.element.hide();return this}});UI.Element.implement({setStyle:function(A,B){this.element.setStyle(A,B);return this},setStyles:function(A){this.element.setStyles(A);return this},getStyle:function(A){return this.element.getStyle(A)},inject:function(B,A){this.fireEvent("inject");this.element.inject(B,A);this.element.setStyle("visibility","visible");this.setSize();this.setCanvas();this.controller.register(this);this.fireEvent("injected");return this},adopt:function(A){this.element.adopt(A);this.setSize();return this},addClass:function(A){this.element.addClass(A);return this},set:function(B,A){if(B=="html"&&this.label){this.label.set(B,A)}else{this.element.set(B,A)}return this},get:function(A){return this.element.get(A)},getSize:function(){return this.element.getSize()},getCoordinates:function(A){return this.element.getCoordinates(A)},destroy:function(){this.element.destroy();return }});Element.implement({disableSelect:function(){if(typeof this.onselectstart!="undefined"){this.onselectstart=function(){return false}}else{if(typeof this.style.MozUserSelect!="undefined"){this.style.MozUserSelect="none"}else{this.onmousedown=function(){return false}}}this.style.cursor="default";return this},enableSelect:function(){if(this.onselectstart){this.onselectstart=""}else{if($type(this.style.MozUserSelect)=="none"){this.style.MozUserSelect=""}else{this.onmousedown=function(){return true}}}this.style.cursor="default";return this},isVisible:function(){return this.getStyle("display")!="none"},toggle:function(){return this[this.isVisible()?"hide":"show"]()},hide:function(){var B;try{B=this.getStyle("display")}catch(A){}this.store("originalDisplay",B||"block");this.setStyle("display","none");return this},show:function(A){original=this.retrieve("originalDisplay")?this.retrieve("originalDisplay"):this.get("originalDisplay");this.setStyle("display",(A||original||"block"));return this},swapClass:function(A,B){return this.removeClass(A).addClass(B)}});UI.Box=new Class({Extends:UI.Element,options:{component:"box",tag:"div",html:"Box",emboss:false,selectable:false},build:function(A){this.parent(A)}});UI.Bubble=new Class({Extends:UI.Element,options:{component:"bubble",label:"Bubble",target:"element",resetPosition:true,zIndex:1000},initialize:function(A){this.parent(A);this.inject(document.body);this.setLocation();this.fade(1)},build:function(){this.parent();this.control=this.element;if(this.options.label){this.label=new UI.Label({html:this.options.label,styles:this.props.components.label.styles}).inject(this.element)}this.fx=new Fx.Tween(this.element,{wait:false,onStart:function(){this.element.show()},onComplete:function(){if(!this.element.getStyle("opacity")){this.element.hide()}}})},setBehavior:function(){this.parent();this.element.addEvents({click:function(){this.fade(0)}.bind(this)})},setLocation:function(){var A=this.getLocation();this.element.setStyles({left:A.left,top:A.top});if(this.options.resetPosition){this.posFx=new Fx.Morph(this.element,{wait:false});this.reposition=function(){var B=this.getLocation();this.posFx.start({left:B.left,top:B.top})}.bind(this);window.addEvents({resize:this.reposition,setTipsPosition:this.reposition})}},getLocation:function(){var A=this.element.getCoordinates();var D=this.options.target.getCoordinates();if(this.options.type=="default"){var C=D.right-40;var B=D.top-A.height-10}else{if(this.options.type=="bottom"){var C=D.right-40;var B=D.top+D.height+10}}return{top:B,left:C}},setSize:function(B,A){if(this.label){B=B||this.options.width||this.props.width||this.label.getSize().x;A=A||this.options.height||this.props.height||this.label.getSize().y}this.parent(B,A)},fade:function(A){this.fx.start("opacity",A);return this},destroy:function(){window.removeEvent("resize",this.reposition);this.parent()}});UI.Label=new Class({Extends:UI.Element,options:{component:"label",tag:"span",html:"Label",emboss:false,selectable:false}});UI.Scrollbar=new Class({Extends:UI.Element,options:{component:"scrollbar",type:"track",maxThumbSize:32,wheel:32},initialize:function(A){this.parent(A);this.bound={start:this.start.bind(this),end:this.end.bind(this),drag:this.drag.bind(this),wheel:this.wheel.bind(this),page:this.page.bind(this)};this.position={};this.mouse={};this.update();this.attach()},build:function(){if(!this.options.width){this.options.width=this.props.width}this.parent();this.inject(this.options.container,"before");this.thumb=new UI.Element({skin:this.options.skin,component:this.options.component,type:"thumb"}).inject(this.element)},update:function(){this.containerSize=this.options.container.getSize().y;this.setSize(this.options.width.toInt(),this.containerSize);this.containerScrollSize=this.options.container.scrollHeight;if(this.containerScrollSize==0){return }this.isVisible()?this.thumb.element.setStyle("visibility","visible"):this.thumb.element.setStyle("visibility","hidden");this.trackSize=this.element.offsetHeight.toInt();this.containerRatio=this.containerSize/this.containerScrollSize;this.thumbSize=(this.trackSize*this.containerRatio).limit(this.options.maxThumbSize.toInt(),this.trackSize);this.scrollRatio=this.containerScrollSize/this.trackSize;this.thumb.setSize(this.options.width,this.thumbSize);this.updateThumbFromContentScroll();this.updateContentFromThumbPosition()},updateContentFromThumbPosition:function(){this.options.container.scrollTop=this.position.now*this.scrollRatio},updateThumbFromContentScroll:function(){this.position.now=(this.options.container.scrollTop/this.scrollRatio).limit(0,(this.trackSize-this.thumbSize));this.thumb.setStyle("top",this.position.now)},attach:function(){this.thumb.element.addEvent("mousedown",this.bound.start);if(this.options.wheel){this.options.container.addEvent("mousewheel",this.bound.wheel)}this.element.addEvent("mouseup",this.bound.page)},wheel:function(A){this.options.container.scrollTop-=A.wheel*this.options.wheel;this.updateThumbFromContentScroll();A.stop()},page:function(A){if(A.page.y>this.thumb.element.getPosition().y){this.options.container.scrollTop+=this.options.container.offsetHeight}else{this.options.container.scrollTop-=this.options.container.offsetHeight}this.updateThumbFromContentScroll();A.stop()},start:function(A){this.mouse.start=A.page.y;this.position.start=this.thumb.element.getStyle("top").toInt();document.addEvent("mousemove",this.bound.drag);document.addEvent("mouseup",this.bound.end);this.thumb.element.addEvent("mouseup",this.bound.end);A.stop()},end:function(A){document.removeEvent("mousemove",this.bound.drag);document.removeEvent("mouseup",this.bound.end);this.thumb.element.removeEvent("mouseup",this.bound.end);A.stop()},drag:function(A){this.mouse.now=A.page.y;this.position.now=(this.position.start+(this.mouse.now-this.mouse.start)).limit(0,(this.trackSize-this.thumbSize));this.updateContentFromThumbPosition();this.updateThumbFromContentScroll();A.stop()},isVisible:function(){if(this.containerSize<this.containerScrollSize){return true}else{return false}}});var ui=ui||{};UI.Controller=new Class({Implements:[Events,Options],options:{zBase:1},initialize:function(A){this.setOptions();this.zIndex=this.options.zBase;this.groups={};this.elements=[]},register:function(A){var B=UI.elements.push(A)-1;if(A.element.getStyle("zIndex")=="auto"||A.element.getStyle("zIndex")==0){A.element.setStyle("zIndex",A.options.zIndex||this.zIndex++)}if(A.options.group){this.group(B)}},group:function(A){this.groups[UI.elements[A].options.group]=this.groups[UI.elements[A].options.group]||new Array();this.groups[UI.elements[A].options.group].push(A)},serialize:function(B){if(!this.groups[B]){return false}var A=[];this.groups[B].each(function(C){if(C.value){A.push(C.options.name+"="+C.value)}});console.log(A.join("&"))}});ui.controller=ui.controller||new UI.Controller();UI.Control=new Class({Extends:UI.Element,options:{},build:function(){this.parent();this.control=this.element},setSize:function(C,A,D){if(this.label){var B=C||this.options.width||this.props.width||this.label.getSize().x;var E=A||this.options.height||this.props.height||this.label.getSize().y}else{if(this.input&&this.input.getProperty("type")!="hidden"){var B=C||this.options.width||this.props.width||this.input.getSize().x;var E=A||this.options.height||this.props.height||this.input.getSize().y}}this.parent(B,E,D)},setInput:function(B,A){if(!$defined(A)){A="input"}if(!$defined(B)){B="hidden"}if(B){this.input=new Element(A,{type:B,name:this.options.name}).inject(this.control)}else{this.input=new Element(A,{name:this.options.name}).inject(this.control)}switch(A){case"input":this.input.set("value",this.options.value);break;case"textarea":this.input.set("html",this.options.value);break}if(B!="hidden"){this.input.set(this.props.components.input)}},getForm:function(){if(this.control){var A=this.control.getParent();while(A.get("tag")!="form"){A=A.getParent()}return A}return false},setBehavior:function(){this.parent();if(this.input){this.input.addEvents({blur:this.fireEvent.bind(this,"blur"),focus:this.fireEvent.bind(this,"focus")})}},set:function(B,A){if(B=="html"){if(this.label){this.label.set(B,A)}this.setSize()}else{this.element.set(B,A)}}});UI.Input=new Class({Extends:UI.Control,options:{component:"input",name:"ui-input",value:""},build:function(){this.parent();this.setInput("text");this.input.setStyle("width",this.props.width-this.input.getStyle("paddingLeft").toInt()-this.input.getStyle("paddingRight").toInt())},setState:function(A){this.parent(A);if(this.skin[A]){this.input.set(this.skin[A].components.input.styles)}},setBehavior:function(){this.parent();this.addEvents({blur:this.setState.bind(this,"default"),focus:this.setState.bind(this,"focus")})}});UI.Button=new Class({Extends:UI.Control,options:{component:"button",label:"Button",submit:false},build:function(){this.parent();if(this.options.label){this.label=new UI.Label({skin:this.options.skin,html:this.options.label,styles:this.props.components.label.styles}).inject(this.element)}},setState:function(A){if(this.label&&this.skin[A]){this.label.setStyles(this.skin[A].components.label.styles)}this.parent(A)},setBehavior:function(){this.parent();this.element.addEvents({mouseenter:this.setState.bind(this,"over"),mousedown:function(A){this.setState("down");new Event(A).stop()}.bind(this),mouseleave:function(){this.setState(this.options.state)}.bind(this),mouseup:function(){if(this.options.submit){this.submit()}this.setState("over")}.bind(this)})},submit:function(){this.getForm().submit()}});UI.Textarea=new Class({Extends:UI.Control,options:{component:"textarea",name:"ui-input",value:""},build:function(){this.parent();this.setInput(false,"textarea");this.input.set({styles:{width:this.props.width-this.input.getStyle("paddingLeft").toInt()-this.input.getStyle("paddingRight").toInt(),height:this.props.height-this.input.getStyle("paddingTop").toInt()-this.input.getStyle("paddingBottom").toInt(),overflow:"hidden"}})},setState:function(A){this.parent(A);return this},setBehavior:function(){this.parent();this.addEvents({blur:this.setState.bind(this,"default"),focus:this.setState.bind(this,"focus")})}});UI.Checkbox=new Class({Extends:UI.Control,options:{label:false,name:"checkbox-input",value:"default",checked:false,component:"checkbox"},build:function(){this.parent();this.setInput();if(this.options.label){this.label=new UI.Label({"for":this.options.name,skin:this.options.skin,html:this.options.label,styles:this.props.labelStyles}).inject(this.element);delete this.props.width;delete this.props.height}this.control.store("value",this.options.value);if(this.options.checked){this.toggleValue()}},toggleValue:function(){if(this.state=="checked"){this.setState("default");this.state="default";this.input.value="";this.value=undefined}else{this.setState("checked");this.state="checked";this.input.value=this.control.retrieve("value");this.value=this.control.retrieve("value")}return this},setBehavior:function(){this.parent();this.element.addEvents({click:function(A){new Event(A).stop();this.toggleValue()}.bind(this)})}});UI.RadiosGroup=new Class({Extends:UI.Control,options:{name:"radiosgroup",component:"radio"},initialize:function(A){this.parent(A);this.radios=[];this.selectedRadio=false;return this},newRadio:function(C){var B=new Element("span",{"class":"ui-radio",styles:$merge({position:"relative",display:"inline-block",height:15,zIndex:this.radios.length+1},C.styles)}).store("value",C.value);this.radios.push(B);if(!this.radios[1]){this.control=B;this.setInput()}if(C.label){var A=new UI.Label({skin:this.options.skin,"for":this.options.name,html:C.label,styles:this.props.styles}).inject(B);B.setStyle("width",100)}else{B.setStyle("width",this.props.width)}this.setCanvas(B);if(C.selected&&!this.selectedRadio){this.selectedRadio=B;this.input.value=B.retrieve("value");this.setState(B,"selected")}this.addRadioAction(B);return B},addRadioAction:function(A){A.addEvents({click:function(){if(this.selectedRadio){this.setState(this.selectedRadio,"default")}this.setState(A,"selected");this.selectedRadio=A;this.input.value=A.retrieve("value")}.bind(this)})},setCanvas:function(A){if(A.canvas||(this.props&&!this.props.layers)||(this.props&&this.props.layers&&this.props.layers.length==0)){return false}A.canvas=new UI.Canvas({props:this.props,width:this.props.width,height:this.props.height}).inject(A);A.addEvent("drawCanvas",function(){this.canvas.setSize(this.element.x,this.element.y,this.props)})},setState:function(A,B){A.canvas.draw(this.skin[B])}});UI.Select=new Class({Extends:UI.Control,options:{component:"select",scrollToSelected:true,list:{}},build:function(){this.parent();this.setInput();this.addMenuActions(this.options.list);this.menu=new UI.Menu({width:this.options.width,skin:this.options.skin,position:"over",target:this.element,menu:this.options.list,scrollToSelected:this.options.scrollToSelected}).inject(document.body);var A=this.menu.content.getFirst().getSize().x;A-=this.menu.content.getFirst().getStyle("paddingRight").toInt();A-=this.menu.content.getFirst().getStyle("paddingLeft").toInt();this.menu.setStyle("display","none");this.label=new UI.Label({width:A,skin:this.options.skin,styles:this.props.components.label.styles,html:this.options.list[0].text}).inject(this.element)},setBehavior:function(){this.parent();this.element.addEvents({mousedown:function(A){this.menu.show(this.element)}.bind(this)})},addMenuActions:function(A){A.each(function(B){if(!B.menu&&B.text!="separator"){B.action=function(){this.input.value=(B.value)?B.value:B.text;this.label.set("html",B.text)}.bind(this)}else{if(B.menu){this.addMenuActions(B.menu)}}},this)}});UI.Slider=new Class({Extends:UI.Element,options:{component:"slider",type:"horizontal",onStart:$empty,onChange:$empty,onComplete:$empty,onTick:$empty,snap:false,offset:0,range:false,wheel:false,steps:100},initialize:function(A){this.parent(A)},build:function(){this.parent();this.handler=new UI.Element({skin:this.options.skin,component:"slider",type:"knob"}).inject(this.element)},inject:function(B,A){this.fireEvent("inject");this.element.inject(B,A);this.element.setStyle("visibility","visible");this.setSize();this.setCanvas();this.controller.register(this);this.slider=new Slider(this.canvas.canvas,this.handler.element,{snap:this.options.snap,offset:this.options.offset,range:this.options.range,wheel:this.options.wheel,steps:this.options.steps,mode:this.options.type,onStart:function(C){this.fireEvent("start",C)}.bind(this),onTick:function(C){if(this.options.snap){C=this.toPosition(this.step)}this.knob.setStyle(this.property,C)},onChange:function(C){this.fireEvent("change",C)}.bind(this),onComplete:function(C){this.fireEvent("complete",C)}.bind(this)});this.fireEvent("injected");return this},setBehavior:function(){this.parent();this.addEvent("complete",function(A){this.value=A})},set:function(A){this.slider.set(A);return this}});UI.Menu=new Class({Extends:UI.Element,options:{component:"menu",rolloverType:"menuRollover",zIndex:3000,contentTag:"div",itemTag:"div",position:"normal",scrollToSelected:false,scrollMargin:20,menu:[],underlay:false},build:function(A){this.parent();this.content=new Element(this.options.contentTag,{styles:{zIndex:2,position:"relative",padding:this.props.components.wrapper.styles.padding,margin:0,listStyle:"none",lineHeight:"1em"}}).inject(this.element);this.setMenu();this.element.setStyles({zIndex:this.options.zIndex})},setMenu:function(B){this.empty();var A=(B)?B:this.options.menu;A.each(function(D){if(D.text=="separator"){var C=new UI.Label({skin:this.options.skin,tag:this.options.itemTag,html:"",styles:this.props.components.separator.styles}).inject(this.content);C.separator=true}else{var C=new UI.Label({skin:this.options.skin,tag:this.options.itemTag,html:D.text,props:UI.skin.getComponentProps(this.skin,"menuItem")}).set(D.options);if(D.action){C.element.addEvent("action",D.action)}C.inject(this.content)}this.addSubmenuEvents(D,C)},this);return this},addSubmenuEvents:function(B,A){if(B.menu){A.addEvents({mouseenter:function(){if(this.activeItem&&this.activeItem.submenu&&this.activeItem!=A){this.activeItem.submenu.hide()}if(this.activeItem!=A){this.addSubmenu(B,A,"normal")}this.moveRollover(A)}.bind(this)});this.addSubmenuArrow(A)}else{A.addEvents({mouseenter:function(){this.removeSubmenu();(A.separator)?this.removeRollover():this.moveRollover(A)}.bind(this)})}A.element.addEvents({mouseleave:function(){$clear(this.menuActionDelay)}.bind(this),mouseup:function(){this.mouseUpAction(A)}.bind(this),mousedown:function(){if(!A.separator){this.fireEvent("change")}}.bind(this)})},addSubmenu:function(C,B,A){this.menuWithAction=false;$clear(this.menuActionDelay);this.menuActionDelay=(function(){if(!B.submenu){B.submenu=new UI.Menu({skin:this.options.skin,target:B,underlay:this.underlay,menu:C.menu,openOnRollover:this.options.openOnRollover,closeOnRollout:this.options.closeOnRollout,position:A,zIndex:this.options.component=="toolbar"?--this.options.zIndex:++this.options.zIndex,events:{hide:this.removeSubmenu}}).inject(document.body)}else{B.submenu.underlay=this.underlay;B.submenu.show(B)}}.bind(this)).delay(this.props.showDelay)},addSubmenuArrow:function(A){A.arrow=new UI.Element({skin:this.options.skin,component:"element",type:"menuRightArrow",styles:{padding:0,position:"absolute",right:8,display:"block",margin:"4px 0 0 0"}}).inject(A.element,"top");A.element.addEvents({mouseenter:function(){A.arrow.setState("over")},defaultArrow:function(){A.arrow.setState("default")}})},mouseUpAction:function(A){if($time()-this.time>300&&this.rollover){new Fx.Tween(this.rollover.element,{duration:100,onComplete:function(){if(this.selected){this.selected.selected=false}this.selected=A.element;A.element.selected=true;this.underlay.fireEvent("click");A.element.fireEvent("action")}.bind(this)}).start("opacity",0,1)}},setRollover:function(){if(this.rollover){return }this.rollover=new UI.Element({skin:this.options.skin,type:this.options.rolloverType,styles:{position:"absolute",zIndex:1}}).inject(this.element)},moveRollover:function(A){var B=A.getCoordinates(this.element);this.setRollover();if(this.activeItem){this.activeItem.element.fireEvent("defaultArrow");this.activeItem.setState("default")}this.rollover.setSize(B.width,B.height).setStyles({display:"block",top:B.top,left:B.left});A.setState("over");this.activeItem=A},removeRollover:function(){if(this.rollover){this.rollover.destroy();delete this.rollover;this.activeItem.element.fireEvent("defaultArrow");this.activeItem.setState("default")}this.activeItem=false},removeSubmenu:function(){if(this.activeItem&&this.activeItem.submenu){this.activeItem.element.fireEvent("defaultArrow");this.activeItem.submenu.hide(this.props.hideFxDuration)}},setPosition:function(E){var D=E.getCoordinates();var B=this.element.getCoordinates();this.element.setStyle("height",B.height);if(this.options.position=="bottom"){this.setCorners([0,0,4,4]);this.element.setStyles({left:D.left,top:D.bottom});B=this.element.getCoordinates();if(B.bottom+this.options.scrollMargin>(Window.getHeight())||B.top<this.options.scrollMargin){this.addScrolls()}}else{if(this.options.position=="over"){this.setCorners([4,4,4,4]);var C=false;if(this.options.scrollToSelected){this.content.getElements(this.options.itemTag).each(function(H){if(H.selected){C=H}})}var G=(!C)?D.top-this.content.getStyle("paddingTop").toInt():D.top-C.getCoordinates(this.element).top;this.element.setStyles({top:G,left:D.left});windowScroll=Window.getScroll();B=this.element.getCoordinates();B.top-=windowScroll.y;B.bottom-=windowScroll.y;if(B.bottom+this.options.scrollMargin>(Window.getHeight())||B.top<this.options.scrollMargin){this.addScrolls()}}else{var A=[4,4,4,4];if(B.width>(Window.getWidth()-D.right)){var F=D.left-B.width+2;A[1]=0}else{var F=D.right-2;A[0]=0}if(B.height<(Window.getHeight()-D.top+Window.getScroll().y)){var G=D.top-this.content.getStyle("paddingTop").toInt()}else{if(B.height<(D.top-Window.getScroll().y)){var G=D.bottom-B.height+this.content.getStyle("paddingTop").toInt();A=[4,4,A[1],A[0]]}else{A=[4,4,4,4];G=D.top-this.content.getStyle("paddingTop").toInt();this.element.setStyles({top:G,left:F});this.addScrolls()}}this.setCorners(A);this.element.setStyles({top:G,left:F})}}},setCorners:function(A){this.props.layers["default"].radius=A},addScrolls:function(){this.scrolls=new UI.MenuScroller({skin:this.options.skin,element:this.element,content:this.content,margin:this.options.scrollMargin,props:this.props,onScroll:function(){this.removeSubmenu();this.removeRollover()}.bind(this),onResize:function(){var A=this.element.getSize();this.setSize(A.x,A.y)}.bind(this)});this.addEvent("removeScrolls",function(){this.scrolls.removeScrolls();this.removeEvents("removeScrolls")}.bind(this))},addUnderlay:function(A){if(!this.underlay){if(this.options.underlay){this.underlay=this.options.underlay}else{this.underlay=new Element("div",{"class":"menu-underlay",styles:{position:"fixed",width:"100%",height:"100%",background:"#FFF",opacity:0.000001,top:0,left:0,zIndex:this.options.zIndex-50},events:{click:function(){this.hide(300);this.removeUnderlay()}.bind(this),contextmenu:function(B){new Event(B).stop();this.hide();this.removeUnderlay()}.bind(this),mousewheel:function(B){new Event(B).stop()}}}).inject(document.body);this.removeUnderlayEvent=function(B){if(this.underlay){this.underlay.fireEvent("click")}window.removeEvent("resize",this.removeUnderlayEvent)}.bind(this);window.addEvent("resize",this.removeUnderlayEvent.bindWithEvent())}}},removeUnderlay:function(){if(this.underlay&&!this.options.underlay){window.removeEvent("resize",this.removeOverlayEvent);this.underlay.destroy();delete this.underlay}return this},inject:function(A,B){this.time=$time();this.fireEvent("inject");this.element.inject(A,B);this.setSize();if(this.options.position!="over"){this.options.target?this.setPosition(this.options.target):this.setPosition(A);this.setCanvas();this.setStyle("visibility","visible");this.addUnderlay()}else{this.setCanvas()}if(this.options.closeOnRollout){this.canvas.canvas.addEvent("mouseleave",function(){if(this.activeItem){this.underlay.fireEvent("click")}}.bind(this))}return this},show:function(B,A,C){this.time=$time();this.element.setStyle("display","block");this.setPosition(B);this.setSize(A,C);this.parent();this.addUnderlay();return this},hide:function(A){if(!$defined(A)){A=this.props.hideFxDuration}this.fireEvent("hide");this.removeSubmenu();if(!A){this.setStyle("display","none");this.removeRollover();this.fireEvent("removeScrolls")}else{new Fx.Tween(this.element,{duration:A,onComplete:function(){this.setStyle("display","none");this.removeRollover();this.fireEvent("removeScrolls")}.bind(this)}).start("opacity",0)}return this},empty:function(){this.content.empty();return this}});UI.Toolbar=new Class({Extends:UI.Menu,options:{tag:"div",menus:[],zIndex:4000,openOnRollover:false,closeOnRollout:false,rolloverType:"toolbarRollover",component:"toolbar"},build:function(){this.addItemStyles();this.parent();this.element.setStyles({position:"relative",width:"100%"})},inject:function(A,B){this.fireEvent("inject");this.setStyle("visibility","visible");this.element.inject(A,B);this.setSize($(A).getWidth(),false);this.setCanvas();this.controller.register(this);this.fireEvent("injected");window.addEvent("resize",function(){this.setSize(this.element.getParent().getSize().x)}.bind(this));return this},addItemStyles:function(){this.options.menu.each(function(A){A.options=A.options||{};A.options.styles={"float":"left",color:this.props.fontColor}},this)},addSubmenuEvents:function(B,A){if(B.menu){A.element.addEvents({mousedown:function(C){if(this.activeItem!=A){this.time=$time();this.addUnderlay();if(!B.action){this.addSubmenu(B,A,"bottom");this.moveRollover(A)}else{this.menuWithAction=(function(){if(this.activeItem&&this.activeItem.submenu){this.activeItem.submenu.hide(0)}this.moveRollover(A);this.addSubmenu(B,A,"bottom");this.menuWithAction=false}).delay(this.props.actionDelay,this)}}new Event(C).stop()}.bind(this),mouseup:function(){if($time()-this.time>800&&this.underlay){this.underlay.fireEvent("click")}}.bind(this),mouseenter:function(){if(this.activeItem&&this.activeItem!=A&&!B.action){if(this.activeItem.submenu){this.activeItem.submenu.hide(0)}this.addUnderlay();this.addSubmenu(B,A,"bottom");this.moveRollover(A)}else{if(this.options.openOnRollover){A.fireEvent("mousedown")}}}.bind(this),hideSubmenu:function(){if(!A.submenu){return }this.hideFx=new Fx.Tween(A.submenu.element,{duration:this.props.hideFxDuration,onComplete:function(){this.removeRollover();if(this.underlay){this.underlay.fireEvent("click")}this.removeSubmenu()}.bind(this)}).start("opacity",0)}.bind(this)})}A.element.addEvents({mousedown:function(C){console.log("stoppp");if(!B.menu&&this.activeItem){this.activeItem.fireEvent("hideSubmenu")}A.down=true;new Event(C).stop()}.bind(this),mouseleave:function(){A.down=false},mouseup:function(){if(this.menuWithAction||!B.menu){this.removeSubmenu()}if(this.menuWithAction){$clear(this.menuWithAction);delete this.menuWithAction}if(A.down&&(!A.submenu||(A.submenu&&A.submenu.element.getStyle("visibility")=="hidden"))){A.element.fireEvent("action")}A.down=false}.bind(this)})},addUnderlay:function(){this.parent();this.underlay.removeEvents();this.underlay.addEvents({click:function(){this.removeSubmenu();(function(){this.removeRollover()}.bind(this)).delay(this.props.hideFxDuration);this.removeUnderlay()}.bind(this),contextmenu:function(A){new Event(A).stop();this.underlay.fireEvent("click")}.bind(this),mousewheel:function(A){new Event(A).stop()}})}});UI.Context=new Class({Extends:UI.Menu,options:{className:"ui-menu-context",contexts:[],type:"context"},initialize:function(A){this.parent(A);this.addContexts(this.options.contexts);this.element.setStyle("display","none");this.element.inject(document.body)},addContexts:function(A){A.each(function(B){document.body.getElements(B.selector).each(function(C){C.addEvent("contextmenu",function(D){new Event(D).stop();this.setMenu(B.menu);this.show(D)}.bind(this));this.element.addEvent("contextmenu",function(D){new Event(D).stop()})},this)},this);return this},removeContexts:function(A){document.body.getElements(A).each(function(B){B.removeEvents("contextmenu")},this);return this},setPosition:function(A,E){if(!$defined(A)||!$defined(E)){return }var D=this.element.getCoordinates();var C=E+Window.getScrollTop();var B=A+Window.getScrollLeft();if((A+D.width+20)>Window.getWidth()){B=B-D.width}if((E+D.height+20)>Window.getHeight()){C=C-D.height}this.element.setStyles({top:C,left:B})},show:function(A){var B=this.content.getSize();this.parent(false,B.x,B.y);this.setPosition(A.client.x,A.client.y);this.setCanvas()}});UI.MenuScroller=new Class({Implements:[Events,Options],options:{className:"ui-scrollbar",wheel:8,speed:12,margin:20,target:"element",onScroll:$empty,onResize:$empty},initialize:function(A){this.setOptions(A);this.element=this.options.element,this.content=this.options.content;this.margin=this.options.margin;this.resetSize();this.setWrapper();this.setBehavior()},resetSize:function(){var D=Window.getScroll();var B=this.element.getCoordinates();B.top-=D.y;B.bottom-=D.y;var A=[0,0];this.element.setStyle("display","none");var C=Window.getHeight();if(B.top<=this.margin&&B.bottom>C-this.margin){this.content.setStyles({top:B.top-this.margin});this.element.setStyles({top:this.margin,height:C-this.margin*2});A=[1,1]}else{if(B.bottom>C-this.margin){this.element.setStyles({height:C-B.top-this.margin});A[1]=1}else{if(B.top<=this.margin){this.content.setStyles({top:B.top-this.margin});this.element.setStyles({top:this.margin+D.y,height:B.bottom-this.margin});A[0]=1}}}this.element.setStyle("display","block");if(A[0]){this.addUpArrow()}if(A[1]){this.addDownArrow()}},setWrapper:function(){var A=this.element.getCoordinates();this.paddingTop=this.content.getStyle("paddingTop").toInt();this.paddingBottom=this.content.getStyle("paddingBottom").toInt();this.paddingTB=this.paddingTop+this.paddingBottom;this.wrapper=new Element("div",{"class":"menu-overflow-wrapper",styles:{overflow:"hidden",position:"relative",width:A.width,height:A.height-this.paddingTB,marginTop:this.paddingTop,marginBottom:this.paddingBottom,zIndex:2}}).inject(this.element,"top").grab(this.content);this.content.setStyles({paddingTop:0,paddingBottom:0})},setBehavior:function(){this.element.addEvent("mousewheel",function(A){new Event(A).stop();if(A.wheel>0){this.scrollUp(A.wheel)}else{this.scrollDown(A.wheel)}}.bind(this))},removeScrolls:function(){this.content.setStyles({top:0,paddingTop:this.paddingTop,paddingBottom:this.paddingBottom});this.element.setStyles({height:"auto",top:"auto"}).grab(this.content).removeEvents("mousewheel");this.wrapper.destroy();this.fireEvent("destroyArrows")},addUpArrow:function(){var B=Window.getScroll();var A=this.element.getCoordinates();A.top-=B.y;A.bottom-=B.y;this.arrowUp=new Element("div",{"class":"ui-menu-arrow-up"}).setStyles({position:"absolute",width:A.width,height:A.top+25,top:-A.top,left:0,zIndex:2}).inject(this.element,"bottom");this.arrowUp.canvas=new UI.Element({width:A.width,height:25,skin:this.options.skin,type:"menuArrow",state:"up"}).setStyles({position:"absolute",bottom:0,zIndex:-1}).inject(this.arrowUp);this.arrowUp.addEvents({mouseover:function(){this.scroller=this.scrollUp.periodical(30,this,1)}.bind(this),mouseout:function(){$clear(this.scroller)}.bind(this)});this.addEvent("destroyArrows",function(){if(this.arrowUp){this.arrowUp.destroy();this.arrowUp=false}})},addDownArrow:function(){var B=Window.getScroll();var A=this.element.getCoordinates();A.top-=B.y;A.bottom-=B.y;this.arrowDown=new Element("div",{"class":"ui-menu-arrow-down"}).setStyles({position:"absolute",width:A.width,height:window.getHeight()-A.bottom+25,bottom:A.bottom-window.getHeight(),left:0,zIndex:2}).inject(this.element,"bottom");this.arrowDown.canvas=new UI.Element({width:A.width,height:25,skin:this.options.skin,type:"menuArrow",state:"down"}).setStyles({position:"absolute",top:0,zIndex:-1}).inject(this.arrowDown);this.arrowDown.addEvents({mouseover:function(){this.scroller=this.scrollDown.periodical(30,this,-1)}.bind(this),mouseout:function(){$clear(this.scroller)}.bind(this)});this.addEvent("destroyArrows",function(){if(this.arrowDown){this.arrowDown.destroy();this.arrowDown=false}})},scrollDown:function(C){this.fireEvent("scroll");var B=this.element.getCoordinates();var D=this.wrapper.getCoordinates();var A=this.content.getCoordinates();if(A.bottom>D.bottom){if(B.top-Window.getScroll().y-this.options.speed>this.margin){this.element.setStyles({top:this.element.getStyle("top").toInt()-this.options.speed,height:B.height+this.options.speed});this.wrapper.setStyle("height",D.height+this.options.speed);this.fireEvent("resize")}else{if(!this.arrowUp){this.addUpArrow()}this.content.setStyle("top",this.content.getStyle("top").toInt()-this.options.speed*(-C))}}else{if(this.arrowDown){if(!this.arrowUp){this.wrapper.setStyle("height",A.height+this.paddingTB);this.element.setStyle("height",A.height+this.paddingTB);this.element.setStyle("top",this.element.getStyle("top").toInt()+this.paddingTB);this.fireEvent("resize")}else{this.content.setStyle("top",B.height-A.height-this.paddingTB)}$clear(this.scroller);this.arrowDown.destroy();this.arrowDown=false}}},scrollUp:function(C){this.fireEvent("scroll");var B=this.element.getCoordinates();var D=this.wrapper.getCoordinates();var A=this.content.getCoordinates();if(A.top<D.top){if(B.bottom+this.margin<Window.getHeight()+Window.getScroll().y){this.element.setStyle("height",B.height+this.options.speed);this.wrapper.setStyle("height",D.height+this.options.speed);this.content.setStyle("top",this.content.getStyle("top").toInt()+this.options.speed);this.fireEvent("resize")}else{if(!this.arrowDown){this.addDownArrow()}this.content.setStyle("top",this.content.getStyle("top").toInt()+this.options.speed*C)}}else{if(this.arrowUp){this.content.setStyle("top",0);if(!this.arrowDown){this.wrapper.setStyle("height",A.height+this.paddingTB);this.element.setStyle("height",A.height+this.paddingTB);this.fireEvent("resize")}$clear(this.scroller);this.arrowUp.destroy();this.arrowUp=false}}}});UI.View=new Class({Extends:UI.Element,options:{component:"view",width:"100%",height:"100%",overflow:"scrollbar",tag:"div",contentTag:"div",content:{},scrollbar:{},onLoadComplete:$empty},build:function(){this.parent();this.buildOverlay();this.setOverflow();this.show()},buildOverlay:function(){this.overlay=new Element("div",this.props.components.overlay).inject(this.element);this.addEvents({onLoadComplete:function(){this.overlay.hide()}})},setOverflow:function(){if(this.options.overflow!="hidden"){this.content=new Element(this.options.contentTag,this.options.content).setStyles({height:"100%",position:"relative"}).inject(this.element);if(this.options.overflow=="hidden"){this.content.setStyle("overflow","hidden")}if(this.options.overflow=="scrollbar"){this.content.setStyle("overflow","hidden");this.buildScrollbar()}this.content.addEvents({onInject:function(){this.updateSize()}.bind(this)})}else{this.content=this.element}},buildScrollbar:function(){if(this.options.skin){this.options.scrollbar.skin=this.options.skin}this.options.scrollbar.container=this.content;this.scrollbar=new UI.Scrollbar(this.options.scrollbar);this.addEvents({ondLoadCompplete:function(){this.scrollbar.update()},onResize:function(){this.scrollbar.update()}})},setContent:function(B,A){switch(B){case"ajax"||"xhr":this.setAjaxContent(A);break;case"ajaxnu":this.setAjaxNuContent(A);break;case"json":this.setJsonContent(A);break;case"content"||"html":this.setHtmlContent(A);break;case"iframe":this.setIFrameContent(A);break}},setHtmlContent:function(A){this.content.set("html",A);this.fireEvent("onLoadComplete");this.fireEvent("onResize");return this},setAjaxContent:function(A){if(this.iframe){this.iframe.destroy()}new Request.HTML({url:A,update:this.content,method:"get",onComplete:function(){this.fireEvent("onLoadComplete");this.fireEvent("onResize")}.bind(this)}).send();return this},setAjaxNuContent:function(A){new Request.HTML({url:A,method:"get",onComplete:function(D,B,E,C){this.fireEvent("onLoadComplete",new Array(E,D,B,C));this.fireEvent("onResize")}.bind(this)}).send();return this},setJsonContent:function(A){new Request.JSON({url:A,onComplete:function(B){this.fireEvent("onLoadComplete",new Array(B));this.fireEvent("onResize")}.bind(this)}).get();return this},setIFrameContent:function(A){if(!this.iframe){if(this.content){this.content.destroy()}if(this.scrollbar){this.scrollbar.destroy()}this.iframe=new Element("iframe",this.props.components.iframe).inject(this.element)}this.iframe.set("src",A).addEvent("load",function(){this.fireEvent("onLoadComplete");this.fireEvent("onResize")});return this}});UI.ListView=new Class({Extends:UI.View,options:{component:"listview",data:[],itemObject:"Button",item:{component:"itemList",type:"default",label:false},width:"100%",height:"100%",itemType:"itemList",},build:function(){this.parent();this.getData(this.options.url)},getData:function(B,A){if(this.options.url){new Request.JSON({url:B,onComplete:function(C){this.processList(C)}.bind(this)}).get()}else{this.addEvent("injected",function(){this.processList(this.options.data)}.bind(this))}},processList:function(A){if(this.options.skin){this.options.item.skin=this.options.skin}A.each(function(B){var C=new UI[this.options.itemObject](this.options.item).inject(this.content);$H(B).erase("type").each(function(E,D){new UI.Element({html:E,styles:this.props.components[D].styles,}).inject(C.element);this.fireEvent("onResize")},this)},this)}});UI.PanelView=new Class({Extends:UI.View,options:{className:"ui-panelview",properties:{},styles:{width:"100%",height:"100%"},direction:"horizontal",transitionType:"scroll",transitionFx:{duration:1600,wait:false},panel:{className:"ui-panelview-panel",styles:{width:"300px",height:"100%"}},onLoad:$empty,onComlete:$empty,onTransition:$empty,onResize:$empty},initialize:function(A){this.setOptions(A);this.list=new Array();this.fireEvent("onResize");this.build();this.transitionFx=new Fx.Scroll(this.element.element,this.options.transitionFx)},build:function(){this.element=new UI.View({overflow:"hidden",styles:{height:"100%",margin:"0",overflow:"hidden",padding:"0",backgroundColor:"#FFF"}})},add:function(){var A=new UI.View(this.options.panel);A.element.inject(this.element.content);this.list.push(A);this.resize();return A},applyTransition:function(A){this.panel=A;this.transitionFx.toElement(A.element)},next:function(){var A=this.list.indexOf(this.panel)+1;if(this.list[A]){this.applyTransition(this.list[A])}},previous:function(){var A=this.list.indexOf(this.panel)-1;if(this.list[A]){this.applyTransition(this.list[A])}},updateScrollBar:function(){this.list.each(function(A,B){A.scrollbar.update()},this)},resize:function(){var A=0;this.list.each(function(B,C){A=A+B.element.getSize().x})},inject:function(A){this.element.inject(A)},remove:function(A){A.destroy()},removeAllNext:function(A){var C=this.list.indexOf(A)+1;var D=this.list.indexOf(this.list.getLast());if(C>D){return }for(var B=C;B<=D;B++){var A=this.list[B];if(A){this.list.pop(A);A.destroy()}}}});UI.TabView=new Class({Extends:UI.View,options:{component:"tabview",overflow:"hidden"},initialize:function(A){this.tabs=new Array();this.parent(A)},build:function(){this.parent();this.buildTabs()},buildTabs:function(){if(this.options.container){var A=this.options.container}else{var A=this.element}this.tabbar=new UI.Element(this.props.components.tabbar).addEvents({onClick:function(){this.element.setStyle("height","21px")}}).inject(A);this.options.tabs.each(function(B){this.add(B)}.bind(this))},add:function(C){var A=new UI.View({height:this.options.height-21,type:"tab"}).setStyle("height",this.options.height-21).inject(this.content).hide();var B=new UI.Button({type:"tab",label:C.name,onClick:function(){if(B==this.tab){return }if(C.url){A.setContent("ajax",C.url)}A.show();if(this.view){this.view.hide()}B.options.state="active";if(this.tab){this.tab.options.state="default";this.tab.setState("default")}this.tab=B;this.view=A}.bind(this)});if(C.selected){this.selected=B}this.tabs.push(B)},setContent:function(C,B,A){this.view.setContent(C,B,A)},setBehavior:function(){this.parent();this.addEvent("injected",function(){var A=this.selected||this.tabs[0];A.options.state="active";this.tabs.each(function(B){B.inject(this.tabbar)}.bind(this));A.setState("active");A.fireEvent("click")})},setActiveTab:function(A){if(A>0&&A<=this.tabs.length){this.tabs[--A].setState("active");this.tabs[A].fireEvent("click")}}});UI.SplitView=new Class({Extends:UI.View,options:{component:"splitview",overflow:"hidden",minSize:160},build:function(){this.parent();this.addEvent("injected",function(){this.size=this.getSize();this.buildViews();this.buildHandler()}.bind(this))},buildViews:function(){this.views=[];console.log(this.props);console.log(this.props.views);this.props.views.each(function(B){this.views.push(new UI.View(B).inject(this.element))});var A=this.size.x-this.side.element.getSize().x},buildSplitter:function(){this.draglimit={x:[-this.options.minSize,this.width-this.options.minSize],y:[0,0]};this.handler=new Element("div",this.props.components.splitter).setStyles({marginLeft:this.side.element.getSize().x-2,height:this.side.element.getSize().y,backgroundColor:"#000",position:"abolute"}).inject(this.views[1].element);this.handler.makeDraggable({limit:this.draglimit,onDrag:function(){this.resize()}.bind(this),})},resize:function(){this.side.element.setStyle("width",this.handler.getCoordinates().left-this.element.getCoordinates().left+3);this.main.element.setStyle("width",this.element.getSize().x-this.side.element.getSize().x);this.fireEvent("onResize")},inject:function(B,A){this.parent(B,A)}});UI.Window=new Class({Extends:UI.Element,options:{component:"window",title:"Window",width:640,height:480,location:"cascade",top:0,left:0,zIndex:"auto",tag:"div",head:true,view:true,foot:true,controls:["close","minimize","maximize"],useEffects:false,draggable:true,dragLimitX:[-1000,window.getWidth()+1000],dragLimitY:[50,window.getHeight()+1000],dragHandlers:["head","foot"],resizable:true,resizeLimitX:[200,window.getWidth()],resizeLimitY:[200,window.getHeight()],resizeOnDragIfMaximized:false,onMinimize:$empty,onMaximize:$empty,onRestore:$empty,onLoad:$empty,onBlur:$empty,onFocus:$empty,onClose:$empty},initialize:function(B){this.controller=UI.windowController;this.parent(B);var A=this.getInitialLocation();this.options.top=A.top;this.options.left=A.left;this.element.setStyles(A);this.controller.focus(this)},build:function(){this.parent();this.buildHead();this.buildView();this.buildFoot();this.inject(this.options.container||document.body);this.canvas.canvas.addEvent("click",function(A){this.controller.propagateUnderShadow(A)}.bind(this))},buildHead:function(){this.head=new Element("div",this.props.components.head).inject(this.element);this.dragHandlers.push(this.head);this.head.disableSelect();this.buildControls();this.title=new UI.Label(this.props.components.title).inject(this.head);this.setTitle(this.options.title);var A=this.controls.getSize().x;A=0;if(this.props.components.controls.styles["float"]=="right"){this.title.element.setStyle("paddingLeft",A)}else{this.title.element.setStyle("paddingRight",A)}if(this.options.toolbar){this.buildToolbar(this.options.toolbar)}},buildControls:function(){if(!this.options.controls){return }var A=new Array();this.controls=new Element("div",this.props.components.controls).addEvents({mouseenter:function(){A.each(function(B){B.setState("over")})},mouseover:function(){A.each(function(B){B.setState("over")})},mouseleave:function(){A.each(function(B){B.setState("default")})}}).inject(this.head);this.options.controls.each(function(C){this.props.components.control.type=C;var B=new UI.Button(this.props.components.control).addEvent("onClick",this.control.bind(this,C)).inject(this.controls);A.push(B)},this);this.addEvents({onMinimize:function(){this.controls.hide()},onNormalize:function(){this.controls.show()}})},buildToolbar:function(A){this.toolbar=new UI.Toolbar(A).inject(this.head);this.props.layers.underlay.size[1]=this.head.getSize().y;this.addEvents({onMinimize:function(){console.log("bye bye");this.toolbar.hide()},onNormalize:function(){console.log("hello");this.toolbar.show()}});new UI.Button(this.props.components.toggle).addEvent("onClick",this.toggleToolbar.bind(this)).inject(this.head);return this},buildView:function(){if(this.options.tabView){var A=this.options.tabView;this.options.tabView.container=this.element;this.view=new UI.TabView(this.options.tabView).setStyles({position:"absolute",top:this.props.borderSize,left:this.props.borderSize}).inject(this.element);this.view.tabbar.setStyles({width:this.options.width-this.props.borderSize})}else{if(this.options.skin){this.options.view.skin=this.options.skin}if(!this.options.view.type){this.options.view.type=this.props.components.view.type}if(this.options.viewOverflow){this.options.view.overflow=this.options.viewOverflow}var B=$merge(this.props.components.view,this.options.view);this.view=new UI.View(B).inject(this.element);this.addEvents({injected:function(){this.view.fireEvent("onResize")},onMinimize:function(){this.view.hide()},onNormalize:function(){this.foot.show();this.view.show();this.setSize()}})}this.content=this.view.content},buildFoot:function(){if(!this.options.foot||this.foot){return }this.foot=new Element("div",this.props.components.foot).inject(this.element);this.foot.disableSelect();if(this.options.resizable){this.buildResizeHandler()}this.status=new Element("div",this.props.components.status).inject(this.foot);this.dragHandlers.push(this.status);this.setStatus();this.addEvents({onMinimize:function(){this.foot.hide()},onNormalize:function(){this.foot.show()}})},buildResizeHandler:function(){this.resize=new UI.Element({component:"element",type:"resizeHandler"}).inject(this.foot)},toggleToolbar:function(){if(this.toolbar.element.getStyle("display")=="block"){this.props.layers.underlay.size[1]=this.head.getSize().y;this.toolbar.element.hide()}else{this.toolbar.element.show();this.props.layers.underlay.size[1]=this.head.getSize().y}this.updateSize();this.fireEvent("canvasDraw",this.state);return this},setBehavior:function(){this.parent();this.addEvents({mousedown:this.focus.bind(this),resizeComplete:function(){this.maximized=false;var A=this.element.getCoordinates();this.options.width=A.width;this.options.height=A.height}.bind(this)});this.addEvents({onBlur:function(){this.view.overlay.show()},onFocus:function(){this.view.overlay.hide()},onResizeStart:function(){this.view.overlay.show()},onResizeComplete:function(){this.view.overlay.hide()},onDragStart:function(){this.view.overlay.show()},onDragComplete:function(){this.view.overlay.hide()}})},enableDrag:function(){this.parent();this.addEvents({onDragComplete:function(){this.options.location="custom";this.maximized=false;var A=this.element.getCoordinates();this.options.top=A.top;this.options.left=A.left;this.options.width=A.width;this.options.height=A.height}.bind(this)});this.element.setStyle("position","absolute")},focus:function(){if(this.minimized){this.normalize();this.controller.resetMinimizedLocation()}else{if(this.maximized&&this.options.resizeOnDragIfMaximized){this.normalize()}else{this.controller.focus(this)}}if(this.state!="default"){this.setState("default")}},minimize:function(){this.fireEvent("onMinimize");this.maximized=false;this.minimized=true;var A={width:this.skin.minimized.width,height:this.skin.minimized.height};this.setState("minimized",A);var B=this.controller.getMinimizedLocation();this.setLocation(B[0],B[1],"morph");this.controller.focus()},maximize:function(){if(this.maximized){this.normalize()}else{this.setSize(window.getWidth(),window.getHeight()-this.options.dragLimitY[0]);var A=this.getCoordinates();this.options.top=A.top;this.options.left=A.left;this.element.setStyles({top:this.options.dragLimitY[0],left:0});this.minimized=false;this.maximized=true;this.fireEvent("onMaximize")}},normalize:function(){var A={width:false,height:false};this.setState("default",A);this.setLocation();this.controller.focus(this);this.maximized=false;this.minimized=false;this.fireEvent("onNormalize")},getInitialLocation:function(){if(this.options.location=="center"){return this.getCenterLocation()}else{if(this.options.location=="cascade"){var A=this.controller.getCascadeLocation(this);return{top:A.top,left:A.left}}else{return{top:this.options.top,left:this.options.left}}}},updateSize:function(){var F=this.element.getSize();var E=this.props.borderSize;var B=E*2;var D=0;var G=0;if(this.options.head){D=D+this.head.getSize().y;G=this.head.getSize().y}if(this.options.foot){D=D+this.foot.getSize().y}if(this.options.tabView){var A=this.view.tabbar.getSize().y;D=D+A;G=G+A;this.view.tabbar.setStyle("width",F.x-B)}var C=F.y-D;if(this.options.head){this.head.setStyles({width:F.x-B})}this.props.layers.underlay.size[1]=this.head.getSize().y;this.skin.inactive.layers.underlay.size[1]=this.head.getSize().y;this.view.element.setStyles({top:E+G,width:F.x-B,height:C-B});if(this.options.foot){this.foot.setStyles({bottom:-E,width:F.x-B})}this.view.fireEvent("onResize")},setSize:function(B,A,C){this.parent(B,A,C);this.updateSize();return this},setTitle:function(A){this.title.set("html",A);return this},setContent:function(C,B,A){this.view.setContent(C,B,A);return this},setStatus:function(A){this.status.set("html",A);return this},control:function(A){switch(A){case"minimize":this.minimize();break;case"maximize":this.maximize();break;case"close":this.close();break}return this},close:function(){this.controller.close(this)}});UI.Controller=UI.Controller||{};UI.Controller.Window=new Class({Singleton:true,Implements:[Events,Options],options:{className:"ui-winman",version:"0.1a",zBase:2000,zStep:10,cascade:{start:{x:51,y:101},step:{x:20,y:20}},stack:{offsetWidth:4,offsetHeight:4}},initialize:function(A){this.setOptions();UI.elements.window=new Array();this.zIndex=this.options.zBase;window.addEvent("resize",function(){this.resizeMaximizedWindow()}.bind(this))},register:function(A){UI.elements.window.push(A);A.element.setStyle("zIndex",this.zIndex);this.zIndex+=this.options.zStep},close:function(B){B.hide();B.fireEvent("onClose");for(var A=UI.elements.window.length-1;A>=0;A--){if(UI.elements.window[A]==B){B.destroy();delete UI.elements.window[A];UI.elements.window=UI.elements.window.clean()}}this.focus()},focus:function(C){if(!$defined(C)){var E=0;var B;for(var A=UI.elements.window.length-1;A>=0;A--){var D=UI.elements.window[A].element.getStyle("zIndex");if(D>=E&&!UI.elements.window[A].minimized){B=UI.elements.window[A];E=D}}if(B){B.focus()}return }else{if(C&&this.active!=C){if(this.active&&!this.active.minimized){this.blur(this.active)}this.zIndex+=this.options.zStep;C.element.style.zIndex=this.zIndex;this.active=C;C.fireEvent("focus");return }}},blur:function(A){if($defined(A)&&!A.minimized){A.setState("inactive");A.fireEvent("onBlur")}else{if(this.active){this.blur(this.active)}}},getMinimizedLocation:function(){var A=-150;var B=window.getHeight()-35;UI.elements.window.each(function(C,D){if(C.state=="minimized"){A+=C.getStyle("width").toInt()+4}});return[A,B]},resetMinimizedLocation:function(){var A=-150;var B=window.getHeight()-35;UI.elements.window.each(function(C){if(C.state=="minimized"){A+=C.getStyle("width").toInt()+4;C.setLocation(A,B)}})},resizeMaximizedWindow:function(){UI.elements.window.each(function(A){if(A.state=="maximized"){A.setSize({height:window.getHeight()-53,width:window.getWidth()})}})},getCascadeLocation:function(B){var A={left:this.options.cascade.start.x.toInt(),top:this.options.cascade.start.y.toInt()};UI.elements.window.each(function(C,D){if(C.state!="minimized"&&C.options.location=="cascade"){A.left+=this.options.cascade.step.x;A.top+=this.options.cascade.step.y}},this);return A},propagateUnderShadow:function(C){var A=C.client.x;var E=C.client.y;var D=0;var B="";UI.elements.window.each(function(F,G){c=F.element.getCoordinates();if(c.left<=A&&A<=c.left+c.width&&c.top<=E&&E<c.top+c.height){if(F.element.getStyle("z-index")>D){D=F.element.getStyle("z-index");B=F}B.focus()}})},resetCascade:function(){UI.elements.window.each(function(A,B){console.log(A.state);if(A.state=="normalized"){A.setStyles(getCascadePosition(A));A.location="cascade"}})}});UI.windowController=UI.windowController||new UI.Controller.Window();Class.Mutators.Singleton=function(B,A){if(!A){return }B.constructor.__instance=undefined;if($defined(B.initialize)&&$type(B.initialize)=="function"){var C=B.initialize}B.initialize=function(){if(!$defined(this.constructor.__instance)){if($defined(C)&&$type(C)=="function"){C.apply(this,arguments)}this.constructor.__instance=this}return this.constructor.__instance}};if(Browser.Engine.trident){Element.Constructors.canvas=function(A){return new Canvas(A)};document.createStyleSheet().cssText="canvas {text-align:left;display:inline-block;}canvas div, canvas div * {position:absolute;overflow:hidden}canvas div * {width:10px;height:10px;}v\\:*, o\\:*{behavior:url(#default#VML)}"}var Canvas=new Class({initialize:function(){var C=Array.link(arguments,{properties:Object.type,element:$defined});var B=$extend({width:300,height:150},C.properties);var A=(C.element||document.newElement("canvas")).set(B);if(A.getContext){return A}A.attachEvent("onpropertychange",this.changeproperty);A.attachEvent("onresize",this.resize);A.getContext=function(){return this.context=this.context||new CanvasRenderingContext2D(A)};return A.setStyles({width:B.width,height:B.height})},changeproperty:function(B){var A=B.propertyName;if(A=="width"||A=="height"){B=B.srcElement;B.style[A]=B[A];B.getContext().clearRect()}},resize:function(B){B=B.srcElement;var A=B.firstChild;if(A){A.style.width=B.width;A.style.height=B.height}}});var CanvasRenderingContext2D=new Class({initialize:function(A){this.element=new Element("div").setStyles({width:A.clientWidth,height:A.clientHeight}).inject(A);this.m=[[1,0,0],[0,1,0],[0,0,1]];this.l=0;this.rot=0;this.state=[];this.path=[];this.Z=10;this.Z2=this.Z/2;this.miterLimit=this.Z*1},arcScaleX:1,arcScaleY:1,currentX:0,currentY:0,lineWidth:1,strokeStyle:"#000",fillStyle:"#fff",globalAlpha:1,globalCompositeOperation:"source-over",lineCap:"butt",lineJoin:"miter",shadowBlur:0,shadowColor:"#000",shadowOffsetX:0,shadowOffsetY:0,getCoords:function(B,F){var A=this.m,D=this.Z,C=this.Z2,E={x:D*(B*A[0][0]+F*A[1][0]+A[2][0])-C,y:D*(B*A[0][1]+F*A[1][1]+A[2][1])-C};E.toString=function(){return this.x.round()+","+this.y.round()};return E}});CanvasRenderingContext2D.implement({beginPath:function(){this.l=0;this.path.length=0},moveTo:function(A,B){this.path[this.l++]="m";this.path[this.l++]=this.getCoords(A,B);this.currentX=A;this.currentY=B},closePath:function(){this.path[this.l++]="x"},lineTo:function(A,B){this.path[this.l++]="l";this.path[this.l++]=this.getCoords(A,B);this.currentX=A;this.currentY=B},quadraticCurveTo:function(D,C,B,F){var A=2*D,E=2*C;this.bezierCurveTo((A+this.currentX)/3,(E+this.currentY)/3,(A+B)/3,(E+F)/3,B,F)},bezierCurveTo:function(B,F,D,C,A,E){this.path[this.l++]=" c "+[this.getCoords(B,F),this.getCoords(D,C),this.getCoords(A,E)].join(",");this.currentX=A;this.currentY=E},arcTo:Function.empty,arc:function(L,J,I,E,B,F){I*=this.Z;var D=E.cos()*I,N=E.sin()*I,A=B.cos()*I,K=B.sin()*I;if(D==A&&!F){D+=0.125}var G=this.Z2,H=this.getCoords(L,J),C=this.arcScaleX*I,M=this.arcScaleY*I;L-=G;J-=G;this.path[this.l++]=[F?"at ":"wa ",(H.x-C).round()+","+(H.y-M).round()," ",(H.x+C).round()+","+(H.y+M).round()," ",this.getCoords(D+L,N+J)," ",this.getCoords(A+L,K+J),].join("")},rect:function(A,D,B,C){this.moveTo(A,D);this.lineTo(A+B,D);this.lineTo(A+B,D+C);this.lineTo(A,D+C);this.closePath()},fill:function(){this.stroke(true)},stroke:function(E){if(!this.path.length){return }var D=this.Z*10,F=this.fillStyle,C=String.type(F),B=this.processColor(E&&C?F:this.strokeStyle),A=(E)?['filled="true" stroked="',["<v:fill",!C?this.processColorObject(F):'color="'+B.color+'" opacity="'+B.opacity,'"></v:fill>']]:["strokeweight="+0.8*this.lineWidth*this.m[0][0]+' filled="',["<v:stroke","endcap=",(this.lineCap=="butt")?"flat":this.lineCap,"joinstyle=",this.lineJoin,"color=",B.color,'opacity="',B.opacity,'" />']];this.element.insertAdjacentHTML("beforeEnd",['<v:shape path="',this.path.join(""),'" coordorigin="0 0" coordsize="'+100+" "+100+'" ',A[0],'false">',A[1].join(" "),"</v:shape>"].join(""));if(E&&F.img){this.element.getLast().fill=this.element.getLast().fill||{};this.element.getLast().fill.alignshape=false}this.beginPath()},clip:Function.empty,isPointInPath:Function.empty,processColor:function(B){var A=this.globalAlpha;if(B.substr(0,3)=="rgb"){if(B.charAt(3)=="a"){A*=B.match(/([\d.]*)\)$/)[1]}B=B.rgbToHex()}return{color:B,opacity:A}},processColorObject:function(H){var B=Math.abs(H.angle*Math.sin(H.angle*2)*Math.abs(1-this.ratio));if(this.ratio>1){B*=-0.5}if(this.angle>=Math.PI/2){B*=-1}H.angle=(3*Math.PI/2-this.angle+B);var E="";if(H.addColorStop){var C=H.col0,A=H.col1,G="";if(H.stops){for(var F=0,D=H.stops.length;F<D;F++){G+=(100*H.stops[F][0]).round()+"% "+H.stops[F][1]+", "}G=G.substr(0,G.length-2)}E+=((H.r0)?'type=gradientradial focusposition="0.2,0.2" focussize="0.2,0.2"':"type=gradient method=sigma angle="+180*H.angle/Math.PI+" ")+['color="'+C.color,'opacity="'+C.opacity,'color2="'+A.color,'o:opacity2="'+A.opacity,'colors="'+G].join('" ')}return(H.img)?'type="tile" src="'+H.img.src:E}});CanvasRenderingContext2D.implement({clearRect:function(A,D,B,C){this.element.innerHTML="";this.m=[[1,0,0],[0,1,0],[0,0,1]]},fillRect:function(A,D,B,C){this.rect(A,D,B,C);this.fill()},strokeRect:function(A,D,B,C){this.rect(A,D,B,C);this.stroke()}});CanvasRenderingContext2D.implement({scale:function(A,B){this.arcScaleX*=A;this.arcScaleY*=B;this.matMult([[A,0,0],[0,B,0],[0,0,1]])},rotate:function(A){this.rot+=A;var C=A.cos(),B=A.sin();this.matMult([[C,B,0],[-B,C,0],[0,0,1]])},translate:function(A,B){this.matMult([[1,0,0],[0,1,0],[A,B,1]])},transform:function(D,C,F,E,B,A){this.matMult([[D,F,B],[C,E,A],[0,0,1]])},setTransform:function(){this.m=[[1,0,0],[0,1,0],[0,0,1]];this.transform.apply(this,arguments)},matMult:function(B){var A=this.m,G=[[0,0,0],[0,0,0],[0,0,0]];for(var F=3;F--;){var E=B[0][F],D=B[1][F],C=B[2][F];if(E){this.sum(G[0],this.dotmult(E,A[F]))}if(D){this.sum(G[1],this.dotmult(D,A[F]))}if(C){this.sum(G[2],this.dotmult(C,A[F]))}}this.m=G},dotmult:function(A,B){return B.map(function(C){return A*C})},sum:function(B,A){B[0]+=A[0];B[1]+=A[1];B[2]+=A[2]}});CanvasRenderingContext2D.implement({drawImage:function(O){var B=arguments,E=B.length,W=(E==9)?4:0;var C=O.runtimeStyle,J=C.width,F=C.height;C.width="auto";C.height="auto";var H=O.width,R=O.height;C.width=J;C.height=F;var N=0,L=0,P=H,V=R,I=B[++W],G=B[++W],K=B[++W]||H,S=B[++W]||R;if(E==9){N=B[1];L=B[2];P=B[3];V=B[4]}var M=L/R,U=N/H,Q=this.m,A=this.Z,T=$H(this.getCoords(I,G)).map(function(X){return(X/A).round()});var D=(!Q[0][1]&&Q[0][0]==1)?"top:"+T.y+";left:"+T.x:["filter:progid:DXImageTransform.Microsoft.Matrix(","M11=",Q[0][0],"M12=",Q[1][0],"M21=",Q[0][1],"M22=",Q[1][1],"Dx=",T.x,"Dy=",T.y,")"].join(" ");this.element.insertAdjacentHTML("beforeEnd",['<v:group style="',D,'" coordsize="',A*10,",",A*10,'">',["<v:image","src=",O.src,"style=width:"+A*K+";height:"+A*S,"croptop=",M,"cropright=",1-U-P/H,"cropbottom=",1-M-V/R,"cropleft=",U,"/>"].join(" "),"</v:group>"].join(" "))},drawImageFromRect:Function.empty,getImageData:Function.empty,putImageData:Function.empty});CanvasRenderingContext2D.implement({states:["arcScaleX","arcScaleY","currentX","currentY","strokeStyle","fillStyle","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor","globalCompositeOperation"],save:function(){var A={};this.states.each(function(B){A[B]=this[B]},this);this.dStack.push(A);this.mStack.push(this.m)},restore:function(){var A=this.dStack.pop();this.states.each(function(B){this[B]=A[B]},this);this.m=this.mStack.pop()},mStack:[],dStack:[]});CanvasRenderingContext2D.implement({createLinearGradient:function(B,D,A,C){return new CanvasGradient(B,D,A,C,this)},createRadialGradient:function(D,F,C,B,E,A){return $extend(new CanvasGradient(D,F,B,E,this),{r0:C,r1:A})}});var CanvasGradient=new Class({initialize:function(C,E,B,D,A){this.angle=((D-E)/(B-C)).atan();this.ctx=A},addColorStop:function(B,A){A=this.processColor(A);if(B==1||B==0){this["col"+B]=A}else{if(!this.stops){this.stops=[]}this.stops.push([B,A.color])}},processColor:function(B){var A=this.ctx.globalAlpha||1;if(B.substr(0,3)=="rgb"){if(B.charAt(3)=="a"){A*=B.match(/([\d.]*)\)$/)[1]}B=B.rgbToHex()}return{color:B,opacity:A}}});CanvasRenderingContext2D.implement({createPattern:function(A,B){return new CanvasPattern(A,B)}});var CanvasPattern=new Class({initialize:function(A,B){this.img=A;this.rep=B}});